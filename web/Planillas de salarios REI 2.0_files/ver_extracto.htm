<!--</head>
        <body><br/><br/><br/><br/><br/><center>
            <img src='images/enMantenimiento.PNG' align = center border=0 title='mantenimiento'></img>
            <center> <p><font color="DarkBlue " size=10>Este modulo se encuentra en mantenimiento.</font></p>
            <br/>
            <center> <p><font color="DarkBlue " size=10> Agradecemos su comprensi?n.</font></p>
         <td width=50% align=center>
            <a href='bienvenida.php'>
                 <img src='images/atras.gif' align = center border=0 title='Volver'></img>
            </a>
        </td>
        </center></body>-->
<html><head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="REI 2.0">
        <meta name="author" content="Geraxo Sistemas Informaticos">
        <title> REI 2.0</title>
        <link href="ver_extracto_data/bootstrap.css" rel="stylesheet" type="text/css">
        <link href="ver_extracto_data/sb-admin-2.css" rel="stylesheet" type="text/css">
        <link href="ver_extracto_data/custom.css" rel="stylesheet" type="text/css">
        <link href="ver_extracto_data/css_datatable.css" rel="stylesheet" type="text/css">
        <link href="ver_extracto_data/dataTables.css" rel="stylesheet" type="text/css">
        <script type="text/javascript" src="ver_extracto_data/jquery.js"></script>
        <script type="text/javascript" src="ver_extracto_data/custom.js"></script>
        <script type="text/javascript" src="ver_extracto_data/dataTables.js"></script>
        <script type="text/javascript" src="ver_extracto_data/bootstrap-filestyle.js"></script>
        <script type="text/javascript" src="ver_extracto_data/js_datatable.js"></script>
        <script type="text/javascript" src="ver_extracto_data/funciones_js.js"></script>
    </head>
<body>

    <script>
        function subir_ventana() {
            window.scrollBy(0, -1550);
        }

        function select_all(element) {
            var span = document.getElementById("cant_reg").getAttribute("data-value"),
                estado = element.getAttribute("data-estado");
            if (estado == 'none') {
                for (i = 0; i < span; i++) {
                    document.getElementById(i).checked = true;
                    seleccionar(i + 1, element);
                }
                element.setAttribute("data-estado", "all");
            } else if (estado == 'all') {
                for (i = 0; i < span; i++) {
                    document.getElementById(i).checked = false;
                    seleccionar(i + 1, element);
                }
                element.setAttribute("data-estado", "none");
            }
        }


        function seleccionar(idtr, elemento) {
            var element = document.getElementById("tr_" + idtr),
                color = element.getAttribute("data-color"),
                estado = elemento.checked;
            if (color == 'white' && estado == true) {
                element.setAttribute("data-color", "red");
                /*element.setAttribute("data-color", "cornflowerblue");*/
                /*element.setAttribute("style", "background-color: cornflowerblue;");*/
                element.setAttribute("style", "background-color: red;");
            } else if (color != 'white' && estado == false) {
                element.setAttribute("data-color", "white");
                element.setAttribute("style", "background-color: white;");
            }
        }

        function listar_planillas() {
            var cant_reg = document.getElementById("cant_reg").getAttribute("data-value"),
                pla_fra_mark = [],
                pla_nor_mark = [],
                pla_com_mark = [],
                pla_fra_no_mark = [],
                pla_nor_no_mark = [],
                pla_com_no_mark = [],
                elemento,
                tip_planil,
                ele1,
                ele2,
                list_periodo_fra_no_mark = [],
                list_periodo_nor = [],
                periodo1,
                periodo2;

            for (i = 0; i < cant_reg; i++) {

                check = document.getElementById(i).checked;

                elemento = document.getElementById("cod_period" + i);
                tip_planil = elemento.getAttribute("data-tipplanill");

                if (check == true) {

                    if (tip_planil == 'FRA') {
                        pla_fra_mark.push(elemento.getAttribute("data-value"));
                        /*console.log('FRA');*/
                    } else if (tip_planil == 'NOR') {
                        pla_nor_mark.push(elemento.getAttribute("data-value"));
                        list_periodo_nor.push(elemento.getAttribute("value"));
                        /*console.log('NOR');*/
                    } else {
                        pla_com_mark.push(elemento.getAttribute("data-value"));
                    }
                } else {
                    if (tip_planil == 'FRA') {
                        pla_fra_no_mark.push(elemento.getAttribute("data-value"));
                        list_periodo_fra_no_mark.push(elemento.getAttribute("value"));
                        /*console.log('FRA');*/
                    } else if (tip_planil == 'NOR') {
                        pla_nor_no_mark.push(elemento.getAttribute("data-value"));
                        /*console.log('NOR');*/
                    } else {
                        pla_com_no_mark.push(elemento.getAttribute("data-value"));
                    }
                    /*console.log("no marcado: "+i);*/
                }
            }

            if (pla_fra_mark.length == 0 && pla_nor_mark.length == 0 && pla_com_mark.length == 0) {
                document.getElementById('resultado').innerHTML = '<div class="row"><div class="col-lg-2">&nbsp;</div><div class="col-lg-8"><div class="alert alert-danger">No ha seleccionado ninguna planilla</div></div><div class="col-lg-2">&nbsp;</div></div>';
                subir_ventana();
                return false;
            } else if (pla_com_mark.length > 0 && pla_fra_mark.length == 0 && pla_nor_mark.length == 0) {
                document.getElementById('resultado').innerHTML = '<h1></h1>';
                return true;
            }

            if (pla_fra_mark.length > 0) {
                /*ordenadas de menor a mayor*/
                pla_fra_no_mark.sort(function (x, y) {
                    return x - y;
                });
                /*console.log('planillas fraccionadas no marcadas ordenada: '+pla_fra_no_mark);*/

                /*ordenadas de mayor a menor*/
                pla_fra_mark.sort(function (x, y) {
                    return y - x;
                });
                /*console.log('planillas fraccionadas marcadas ordenada: '+pla_fra_mark);*/

                /*control de salto en cuotas*/
                ele1 = parseInt(pla_fra_no_mark[0]);
                ele2 = parseInt(pla_fra_mark[0]);
                if (ele1 >= ele2 || isNaN(ele1) == true) {
                    /*console.log('todo bien frac');*/
                    document.getElementById('resultado').innerHTML = '<span></span>';
                } else {
                    /*console.log('todo mal frac');*/
                    document.getElementById('resultado').innerHTML = '<div class="row"><div class="col-lg-2">&nbsp;</div><div class="col-lg-8"><div class="alert alert-danger">Registra cuota de fraccionamiento pendiente</div></div><div class="col-lg-2">&nbsp;</div></div>';
                    subir_ventana();
                    return false;
                }
            }

            pla_nor_no_mark.sort(function (x, y) {
                return x - y;
            });
            /*console.log('planillas fraccionadas no marcadas ordenada: '+pla_nor_no_mark);*/
            pla_nor_mark.sort(function (x, y) {
                return y - x;
            });
            /*console.log('planillas fraccionadas marcadas ordenada: '+pla_nor_mark);*/

            if (pla_nor_mark.length > 0) {
                /*control de salto en planillas normales*/
                ele1 = parseInt(pla_nor_no_mark[0]);
                ele2 = parseInt(pla_nor_mark[0]);

                if (ele1 >= ele2 || isNaN(ele1) == true) {
                    /*console.log('todo bien nor');*/
                    document.getElementById('resultado').innerHTML = '<span></span>';
                } else {
                    /*console.log('todo mal nor');*/
                    document.getElementById('resultado').innerHTML = '<div class="row"><div class="col-lg-2">&nbsp;</div><div class="col-lg-8"><div class="alert alert-danger">Registra planilla normal pendiente</div></div><div class="col-lg-2">&nbsp;</div></div>';
                    subir_ventana();
                    return false;
                }
            }

            if (pla_fra_no_mark.length > 0 || pla_fra_mark.length > 0) {
                list_periodo_fra_no_mark.sort(function (x, y) {
                    return x - y;
                });
                /*console.log('periodos fraccionados no marcados ordenados: '+list_periodo_fra_no_mark);*/

                list_periodo_nor.sort(function (x, y) {
                    return y - x;
                });
                /*console.log('periodos normales marcados ordenados: '+list_periodo_nor);*/

                /*control de correspondencia en planillas y cuotas*/
                ele1 = parseInt(list_periodo_nor[0]) + 1;
                if (buscar_elemento(list_periodo_fra_no_mark, ele1)) {
                    /*console.log('faltan pagar cuotas');*/
                    document.getElementById('resultado').innerHTML = '<div class="row"><div class="col-lg-2">&nbsp;</div><div class="col-lg-8"><div class="alert alert-danger">Cuenta con cuotas pendientes en su fraccionamiento</div></div><div class="col-lg-2">&nbsp;</div></div>';
                    subir_ventana();
                    return false;
                } else {
                    document.getElementById('resultado').innerHTML = '<span></span>';
                    /*console.log('no falta pagar ninguna cuota');*/
                }
            }
            return true;
        }

        function buscar_elemento(array, searchelement) {
            for (e = 0; e < array.length; e++) {
                if (array[e] == searchelement) {
                    return true;
                }
            }
            return false;
        }

        function llamar_pantalla(opcion, ancho, alto) {
            var w = screen.availWidth, h = screen.availHeight;
            var leftPos = (w - ancho) / 2, topPos = (h - alto) / 2;
            if (opcion != '') {
                window.open(opcion, '', 'scrollbars=yes,height=' + alto + ',width=' + ancho + ',resizable=yes,status=1');
            }
        }

        function abrir_ventana(pag_pdf) {
            var a, b;
            llamar_pantalla('abre_extracto_pdf.php?pag_pdf=' + pag_pdf, 1050, 800);
            llamar_pantalla('token.php', 450, 230);
        }

        function mostrar_mensaje(mostrar_resultado, exito, retpag) {
            location.replace('error_movimiento_2.php?error=' + mostrar_resultado + '&exito=' + exito + '&retpag=' + retpag);
        }
    </script>


    <form method="POST" action="ver_extracto.php">
                <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-primary">
                    <div class="panel-heading" align="center">
                        <h3>GENERACIÃ“N DE EXTRACTO</h3></div>
                    <div class="panel-body">

                        <div class="row">
                            <div class="col-sm-2">
                                &nbsp;
                            </div>

                            <div class="col-sm-8" align="center">
                                <!---------- PANEL TIPO PLANILLAS-->
                                <div class="panel panel-default">
                                    <div class="panel-heading"><label>INFORMACION SOBRE LA PLANILLA</label></div>
                                    <div class="panel-body">
                                        <div class="row">
                                            <div class="col-sm-6" align="left"><label>NOR: </label> NORMAL</div>
                                            <div class="col-sm-6" align="left"><label>FRA: </label> FRACCIONAMIENTO
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-6" align="left"><label>COM: </label> COMPLEMENTARIA</div>
                                            <div class="col-sm-6" align="left"><label>BDS: </label> BOLETIN DE
                                                DIFERENCIA SALARIAL
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-sm-12" align="left"><label>BDF: </label> BOLETIN DE
                                                DIFERENCIA FRACCIONAMIENTO
                                            </div>

                                        </div>
                                    </div><!-- PANEL BODY-->
                                </div>
                                <!--  FIN PANEL PLANILLAS-->

                            </div>
                            <div class="col-sm-2">
                                &nbsp;
                            </div>
                        </div>
                    </div>

                    <input name="tipo_impresion" type="hidden" value="Extracto">
                    <input name="fra" type="hidden" value="">
                    <input name="operacion" type="hidden" value="">
                    <input name="fracnum" type="hidden" value="">
                    <!---------- PANEL MOVIMIENTO-->
                    <span id="resultado"></span>
                    <div class="panel panel-info">
                        <div class="panel-heading" align="center"><label>MOVIMIENTOS A LA FECHA</label><br>
                                                        <label>NRO PATRONAL : </label> &nbsp; 0005-75-02200&nbsp;<label>
                                RUC: </label>&nbsp; 554483&nbsp; <label>RAZON SOCIAL: </label>&nbsp;SAMANIEGO DE ESPINOLA, ELADIA                        </div>
                        <div class="panel-body" align="center">
                            <div class="row">
                                <div class="col-lg-12">
                                    <table class="lista" width="85%"><thead><tr>
				<th rowspan="2"> <input value="Seleccionar todo" data-estado="all" onclick="select_all(this);" type="checkbox" checked="checked"></th>
				<th colspan="6">Datos Planilla</th>
				<th colspan="3">Datos Fraccionamiento</th>
				</tr> <tr> 	<th> Periodo </th>
						<th align="center"> Ide  </th>
						<th align="center"> Tipo  </th>
						<th align="center"> Cant Aseg </th>
						<th align="center"> Imponible </th>
						<th align="center"> Total Aporte </th>
						<th align="center"> Num Cuota </th>
						<th align="center"> Interes Punit </th>
						<th align="center"> Interes <br> Mora </th>						
						</tr>
						</thead>
						<tbody>
						<tr id="tr_1">
	<td valign="center" align="center">
	<input type="checkbox" onclick="seleccionar(1, this);" name="check0" id="0" value="check0" checked="checked">
	</td><td align="center">
							
	<input type="text" name="des_period0" value="AGOSTO/2019" style="text-align:left" readonly="true" size="20" class="imput_datatable">
											<input type="hidden" readonly="true" name="nro_patron0" value="0005-75-02200" class="imput_datatable">
											<input type="hidden" name="des_emplea0" value="SAMANIEGO DE ESPINOLA, ELADIA" tabindex="99999" readonly="true" size="45">

							</td>
							<td>
								<input type="text" name="ide_planil0" value="10851203" style="text-align:right" class="imput_datatable" readonly="true" size="10">
							</td>
							<td align="center">
								<input type="text" name="tip_planil0" value="NOR" size="5" style="text-align:center" class="imput_datatable_3" readonly="true">	
							</td>
							<td align="center">
								<input type="text" name="can_asegur0" value="1" size="6" style="text-align:center" class="imput_datatable" readonly="true">
							</td>
							<td align="center">
								<input type="text" name="tot_impon0" value="2.192.839" size="18" style="text-align:right" class="imput_datatable" readonly="true">
							</td>
							<td align="center">
								<input type="text" name="tot_aporte0" value="559.173" size="18" style="text-align:right" class="imput_datatable" readonly="true">
								<input type="hidden" name="ide_modpag0" value="0">
<input type="hidden" data-tipplanill="NOR" data-value="1" id="cod_period0" name="cod_period0" value="919">
<input type="hidden" name="ide_boletin0" value="0">
<input type="hidden" name="fec_venlic0" value="">
<input type="hidden" name="cod_zona0" value="5">
<input type="hidden" name="cod_activi0" value="75">
<input type="hidden" name="nro_emplea0" value="2200">
<input type="hidden" name="des_emplea0" value="SAMANIEGO DE ESPINOLA, ELADIA">
<input type="hidden" id="ide_planil0" name="ide_planil0" value="10851203">
<input type="hidden" name="ind_estpla0" value="A">
<input type="hidden" name="ind_lote0" value="DI">
<input type="hidden" name="tip_planil_aux0" value="">
<input type="hidden" name="fec_vencuo_20" value="">
<input type="hidden" name="mon_amorca0" value="0">
<input type="hidden" name="can_cuota0" value="0">
<input type="hidden" name="ide_emplea0" value="202270">
<input type="hidden" name="mon_cuota0" value="0" +="" 0="">
<input type="hidden" name="dias_venc0" value="0">

<input type="hidden" name="tot_apoaseg0" value="197355">
<input type="hidden" name="tot_recarga0" value="0">
<input type="hidden" name="tot_emple0" value="361818">
							</td>
							<td align="center">
								<input type="text" name="num_cuota0" value="0" size="5" style="text-align:right" class="imput_datatable" readonly="true">
							</td>
							<td align="center">
								<input type="text" name="mon_intpun0" value="0" size="18" style="text-align:right" class="imput_datatable" readonly="true">
							</td>
							<td align="center">
								<input type="text" name="mon_intmor0" value="0" size="18" style="text-align:right" class="imput_datatable" readonly="true">
							</td></tr></tbody></table><span id="cant_reg" data-value="1"></span>                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-lg-12">
                                    

                                    <input type="button" value="Generar" onclick="enviar()" class="btn btn-primary">                                                                            <span data-value="no" id="isfra"></span>
                                                                        <input type="hidden" value="1" name="generar">
                                    <input type="hidden" value="1" name="cont">
                                    <input type="hidden" name="max_pago" value="918">                                    <!---------- FIN PANEL PRINCIPAL-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!---------- FIN PANEL MOVIMIENTOS-->
        

    </form>
<form name="mostrar_mensaje" method="POST" action="ver_extracto.php">

    <input type="hidden" name="errores" value=""><input type="hidden" name="nro_extrac" value="">    
<script language="JavaScript">
	error = 0;
	ok = 0;

	function enviar()
	{
		var ret=false,
		isfra = document.getElementById('isfra').getAttribute('data-value'),
		lp = false;
		
		if(isfra == 'no'){
			lp = listar_planillas();
			
			if(lp == false){
				return 0;
			}
		}

		verificar();
		if (error == -1 )
		{
			  alert('El monto del boletin de reposo no puede superar el 9% de aporte a pagar');
			  location.reload(); 
		}
		if (error > 0 )
		{
		  alert('Debe seleccionar las cuotas anteriores pendientes al que usted selecciono.');
		  error = 0;
		}
		else if (error==0 && ok==0)
		{
		  alert('Debe seleccionar los items para poder generar.');
		}
		else if (ok > 0 && error == 0)
		{
			rep = verificar_max_pago();
				if (!rep)
					return false;
				else 
					ret = confirm('\Esta seguro que desea generar con los items seleccionados?');
				
				if (ret)
				{
					document.forms[0].submit();
					ok = 0;
				}	}
	}

	function verificar()
	{

		var pla;
		var pla_aux;
		var nro;
		var nro_aux;
		var lin;
		var check;
		var check_aux;
		var tip_planil;
		var ide_emplea;
		var ide_emplea_aux;
		var cod_activi;
		var ind_lote;
		var ide_planil;
		var tot_norm = 0;
		var tot_bdr = 0;
		var tmp;

		check =	document.getElementById(0).checked;
				if (check == true)
				{
					tip_planil = document.forms[0].tip_planil0.value;
					ide_emplea = document.forms[0].ide_emplea0.value;
					cod_activi = document.forms[0].cod_activi0.value;
					ind_lote = document.forms[0].ind_lote0.value;
					ide_planil = document.forms[0].ide_planil0.value;
					cod_period = document.forms[0].cod_period0.value;
					tmp = document.forms[0].tot_impon0.value;
					tmp = tmp.split('.').join('');
					
					if (tip_planil=='BDR')
					{
						tot_bdr	= tot_bdr + Number(tmp);
					}
					else if (tip_planil=='NOR' || tip_planil=='COM')
					{
						tot_norm	= tot_norm	+ Number(tmp);				
					}
					if (cod_activi != 85 && (ind_lote != 'WE' && ind_lote != 'DI') && tip_planil == 'NOR' )
					{
						ok=-1;
						alert('No puede liquidar planillas de diskete que no fueron digitadas, planilla '+ide_planil);
						return false;
					}
				   if (tip_planil == 'FRA')
				   {
					  pla = tip_planil;
					  nro = document.forms[0].num_cuota0.value;
				   }
				   else
				   {
					  pla = tip_planil;
					  nro = document.forms[0].cod_period0.value;
				   }
				   /*alert(check_aux);*/
				   check_aux =	document.getElementById(0).checked;
						/*alert(check_aux);*/
						ide_emplea_aux = document.forms[0].ide_emplea0.value;
						cod_period_aux = document.forms[0].cod_period0.value;

					   if (document.forms[0].tip_planil0.value == 'FRA')
					   {
						  pla_aux = document.forms[0].tip_planil0.value;
						  nro_aux = document.forms[0].num_cuota0.value;

						  if (tip_planil=='NOR' )
						  {
							  if (Number(cod_period) > 0 && Number(cod_period_aux) > 0)
							  {
								  if (pla_aux=='FRA' && check_aux==false && Number(cod_period)+Number(1) >= Number(cod_period_aux))
								  {
									  ok = -1;
									  alert('LA EMPRESA POSEE CUOTAS DE FRACCIONAMIENTO ATRASADAS, COMUNIQUESE CON EL DPTO. DE COBRANZAS');
									  return false;
								  }
							  }
						  }
					   }
					   else
					   {
						  pla_aux = document.forms[0].tip_planil0.value;
						  nro_aux = document.forms[0].cod_period0.value;
					   }
					   /*alert('nro_aux='+nro_aux + ' nro='+nro+' pla='+pla+' check_aux='+check_aux+' tip_planil='+tip_planil+' fra='+'');*/
					   if (Number(nro_aux)<Number(nro) && pla==pla_aux && check_aux==false && ide_emplea==ide_emplea_aux && tip_planil!='BDR')
					   {
							error++;
					   }
					   else
					   {
						   ok++;
					   }}	if(tot_bdr > (tot_norm*9/100))
				{
						error=-1;
						return false;
				}
	
		}

function verificar_max_pago()
{
	var max_pago;
	var can_filas;
	var i;
	max_pago = document.forms[0].max_pago.value;
	can_filas = document.forms[0].cont.value;

	for(i=0;i<can_filas;i++)
	{
		if ( document.getElementById(i).checked && eval('document.forms[0].tip_planil'+i+'.value') == 'NOR')
		{
			if (Number(eval('document.forms[0].cod_period'+i+'.value')) != (Number(max_pago) + 1) && max_pago)
				rep = confirm('FALTA COBRAR PERIODOS ANTERIORES, DESEA CONTINUAR DE TODOS MODOS?');
			else
				rep = 1;

			return rep;
		}
	}
	return true;
}

</script></form></body></html>